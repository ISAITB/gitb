<div id="conformanceDashboardPage" class="page conformancedashboard">

    <div tb-test-filter 
        filters = "adminConformanceCtrl.filters"
        state = "adminConformanceCtrl.filterState"
		apply-fn = "adminConformanceCtrl.getConformanceStatements"
        community-id = "adminConformanceCtrl.communityId"
        load-domains-fn = "adminConformanceCtrl.getAllDomains"
        load-specifications-fn = "adminConformanceCtrl.getAllSpecifications"
        load-actors-fn = "adminConformanceCtrl.getAllActors"
        load-communities-fn = "adminConformanceCtrl.getAllCommunities"
        load-organisations-fn = "adminConformanceCtrl.getAllOrganizations"
		load-systems-fn = "adminConformanceCtrl.getAllSystems"
        load-organisation-properties-fn = "adminConformanceCtrl.getOrganisationPropertiesForFiltering"
        load-system-properties-fn = "adminConformanceCtrl.getSystemPropertiesForFiltering">
    </div>

	<div id="conformanceDashboardPageTable" class="panel panel-default">
		<div class="panel-heading">
			<h4 id="conformance-statements-title" class="title">Conformance statements</h4>
			<div class="btn-toolbar pull-right padded">
				<button type="button" class="btn btn-default" ng-if="adminConformanceCtrl.conformanceStatements.length > 0" ng-click="adminConformanceCtrl.onExportConformanceStatementsAsCsv()" ng-disabled="adminConformanceCtrl.exportPending"><span class="tab" ng-if="adminConformanceCtrl.exportPending"><i class="fa fa-spinner fa-spin fa-lg fa-fw"></i></span>Export CSV</button>
				<button type="button" class="btn btn-default" ng-if="adminConformanceCtrl.showCollapseAll()" ng-click="adminConformanceCtrl.onCollapseAll()">Collapse all</button>
			</div>
		</div>
		<table class="table table-directive expandable-table">
			<thead>
			<tr>
				<th ng-if="!adminConformanceCtrl.DataService.isCommunityAdmin">Community</th>
				<th>{{adminConformanceCtrl.DataService.labelOrganisation()}}</th>
				<th>{{adminConformanceCtrl.DataService.labelSystem()}}</th>
				<th ng-if="adminConformanceCtrl.DataService.isSystemAdmin || (adminConformanceCtrl.DataService.isCommunityAdmin && adminConformanceCtrl.DataService.community.domain === null)">{{adminConformanceCtrl.DataService.labelDomain()}}</th>
				<th>{{adminConformanceCtrl.DataService.labelSpecification()}}</th>
				<th>{{adminConformanceCtrl.DataService.labelActor()}}</th>
				<th width="20%">Test results</th>
				<th class="th-min-centered">Status</th>
				<th class="operations">Export</th>
			</tr>
			</thead>
			<tbody ng-if="adminConformanceCtrl.dataStatus.status == adminConformanceCtrl.Constants.STATUS.PENDING">
				<tr><td ng-attr-colspan="{{adminConformanceCtrl.columnCount}}" class="td-data-loading"><span><i class="fa fa-spinner fa-spin fa-lg fa-fw"></i></span></td></tr>
			</tbody>
			<tbody ng-if="adminConformanceCtrl.dataStatus.status == adminConformanceCtrl.Constants.STATUS.FINISHED && adminConformanceCtrl.conformanceStatements.length == 0">
				<tr><td ng-attr-colspan="{{adminConformanceCtrl.columnCount}}" class="td-no-data"><span>No conformance data found</span></td></tr>
			</tbody>
			<tbody ng-if="adminConformanceCtrl.conformanceStatements.length > 0">
				<tr ng-repeat-start="statement in adminConformanceCtrl.conformanceStatements"
					ng-click="adminConformanceCtrl.onExpand(statement)"
					class="table-row-directive expandable-table-row-collapsed">
					<td ng-if="!adminConformanceCtrl.DataService.isCommunityAdmin">{{statement.communityName}}</td>
					<td>{{statement.organizationName}}</td>
					<td>{{statement.systemName}}</td>
					<td ng-if="adminConformanceCtrl.DataService.isSystemAdmin || (adminConformanceCtrl.DataService.isCommunityAdmin && adminConformanceCtrl.DataService.community.domain === null)">{{statement.domainName}}</td>
					<td>{{statement.specName}}</td>
					<td>{{statement.actorName}}</td>
					<td>{{statement.status}}</td>
					<td class="td-min-centered"><span><i ng-class="adminConformanceCtrl.DataService.iconForTestResult(statement.overallStatus)"></i></span></td>
					<td class="operations">
						<button ng-if="!statement.exportPending" class="btn btn-default" ng-click="adminConformanceCtrl.onExportConformanceStatement(statement); $event.stopPropagation();"><i class="fa fa-file-pdf-o"></i></button>
						<button ng-if="statement.exportPending" class="btn btn-default pending" disabled="disabled"><i class="fa fa-spinner fa-spin fa-lg fa-fw"></i></button>
					</td>
				</tr>
				<tr ng-repeat-end class="expandable-table-row-expanded">
					<td colspan="9" class="expandable-table-expandable-cell">
						<div uib-collapse="!adminConformanceCtrl.isExpanded(statement)">
							<table class="table table-directive expandable-table conformance-dashboard-tests-table">
								<thead>
									<th width="45%">Test suite</th>
									<th width="45%">Test case</th>
									<th class="tb-result">Result</th>
									<th class="operations">Export</th>
								</thead>
								<tbody>
									<tr ng-repeat="testCase in statement.testCases">
										<td>{{testCase.testSuiteName}}</td>
										<td>{{testCase.testCaseName}}</td>
										<td class="tb-result"><i ng-class="adminConformanceCtrl.DataService.iconForTestResult(testCase.result)"></i></td>
										<td class="operations">
											<button ng-if="adminConformanceCtrl.showExportTestCase(testCase) && !testCase.exportPending" class="btn btn-default" ng-click="adminConformanceCtrl.onExportTestCase(statement, testCase)"><i class="fa fa-file-pdf-o"></i></button>
											<button ng-if="adminConformanceCtrl.showExportTestCase(testCase) && testCase.exportPending" class="btn btn-default pending" disabled="disabled"><i class="fa fa-spinner fa-spin fa-lg fa-fw"></i></button>
										</td>
									</tr>
								</tbody>
							</table>
						</div>
					</td>
				</tr>
			</tbody>
		</table>		
	</div>
</div>
