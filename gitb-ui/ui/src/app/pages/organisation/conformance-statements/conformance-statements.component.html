<div class="page conformance">
	<div class="card mb-0">
		<div class="card-header">
			<div class="card-title">Conformance statements</div>
			@if (showCreate || (conformanceSnapshots != undefined && conformanceSnapshots.length > 0)) {
				<div class="btn-toolbar">
				@if (conformanceSnapshots != undefined && conformanceSnapshots.length > 0) {
					<div class="btn-group" dropdown>
						<button id="button-snapshot" dropdownToggle type="button" class="btn btn-secondary dropdown-toggle" aria-controls="dropdown-snapshot">{{snapshotButtonLabel}}<span class="caret withMargin"></span></button>
						<ul id="dropdown-snapshot" *dropdownMenu class="dropdown-menu dropdown-menu-right" role="menu" aria-labelledby="button-snapshot">
							<li role="menuitem"><a class="dropdown-item" href (click)="snapshotSelected();$event.preventDefault()">{{latestSnapshotButtonLabel}}</a></li>
							<li class="divider dropdown-divider"></li>
							@for (snapshot of conformanceSnapshots; track snapshot.id) {
								<li role="menuitem"><a class="dropdown-item" href (click)="snapshotSelected(snapshot);$event.preventDefault()">{{snapshot.label}}</a></li>
							}
						</ul>
					</div>
				}
				@if (showCreate) {
					<button (click)="createStatement()" [disabled]="system == undefined || currentlySelectedSnapshot != undefined" class="btn btn-secondary">Create statements</button>
				}
				</div>
			}
		</div>
		<div class="card-body">
			@if (systemStatus.status == Constants.STATUS.FINISHED) {
				@if (systems.length == 0) {
					<div class="alert alert-info rounded mb-0" [ngSwitch]="showCreateSystem">
						@if (showCreateSystem && currentlySelectedSnapshot == undefined) {
							<span>No {{dataService.labelSystemsLower()}} defined. You must <a href (click)="toCreateSystem();$event.preventDefault()">create a system</a> before defining its conformance statements.</span>
						} @else if (currentlySelectedSnapshot == undefined) {
							<span>No {{dataService.labelSystemsLower()}} defined. One must be created by an administrator before conformance statements can be defined.</span>
						} @else {
							<span>No {{dataService.labelSystemsLower()}} defined.</span>
						}
					</div>
				} @else {
					<div class="controls">
						<div class="system-filter">
							<div class="system-filter-label">
								{{dataService.labelSystem()}}
							</div>
							<div class="system-filter-value">
								@if (systems.length == 1) {
									<input type="text" name="system" [(ngModel)]="system!.fname" readonly="readonly" class="form-control"/>
								} @else {
									<select name="system" [(ngModel)]="system" (change)="systemChanged(true)" class="form-control form-select">
										<option *ngFor="let system of systems" [ngValue]="system">{{system.fname}}</option>
									</select>
								}
							</div>
						</div>
						@if (statements.length > 0) {
							<div class="text-filter">
								<app-text-filter name="statementFilter" [width]="350" [placeholder]="'Search conformance statements...'" [(ngModel)]="statementFilter" (apply)="filterStatements()"></app-text-filter>
							</div>
							<div class="status-filter">
								<app-checkbox-option-panel 
									label="Show statements..." 
									[options]="statusOptions" 
									(updated)="filterByStatus($event)"></app-checkbox-option-panel>
							</div>
						}
					</div>
					@if (system != undefined) {
						@if (dataStatus.status == Constants.STATUS.FINISHED) {
							@if (statements.length == 0) {
								<div class="alert alert-info rounded mb-0 top-margin">
									<span>No conformance statements defined.</span>
								</div>
							} @else {
								<div class="statement-container" [ngSwitch]="visibleItemCount">
									@if (visibleItemCount == 0) {
										<div class="alert alert-info rounded mb-0 top-margin">
											<span>No conformance statements match your search criteria.</span>
										</div>
									} @else {
										<app-conformance-statement-items-display [items]="statements" [animated]="animated" [withCheck]="false" [withResults]="true" (selectionChanged)="onStatementSelect($event)"></app-conformance-statement-items-display>
									}
								</div>
							}
						} @else {
							<div class="pending-container top-margin">
								<div class="pending-icon"><app-pending-block [pending]="true"></app-pending-block></div>
								<div class="pending-message">Loading conformance statements for {{system!.fname}}...</div>
							</div>
						}
					} @else {
						<div class="alert alert-info rounded mb-0 top-margin">
							<span>Select a {{dataService.labelSystemLower()}} to view its conformance statements.</span>
						</div>
					}
				}
			} @else {
				<div class="pending-container">
					<div class="pending-icon"><app-pending-block [pending]="true"></app-pending-block></div>
					<div class="pending-message">Loading {{dataService.labelSystemsLower()}}...</div>
				</div>
			}
		</div>
		<div class="card-footer" *ngIf="showBack">
			<div class="btn-toolbar">
				<button type="button" class="btn btn-secondary" (click)="back()">Back</button>
			</div>
		</div>
	</div>
</div>
