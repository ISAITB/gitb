<div id="conformanceDetailPage" class="page conformance">
	<div class="panel panel-default">
		<div class="panel-heading clickable" (click)="collapsedDetails = !collapsedDetails">
			<h4 class="title"><app-collapsing-icon [isCollapsed]="collapsedDetails"></app-collapsing-icon>Conformance statement details</h4>
		</div>
		<div [collapse]="collapsedDetails" [isAnimated]="true">
			<div class="panel-body">
				<div class="row row-display-first">
					<div class="col-md-2"><strong>{{dataService.labelDomain()}}</strong></div>
					<div class="col-md-10">{{domain?.fname}}</div>
					<div class="col-md-10 col-md-offset-2 row-display-inner" *ngIf="domain?.description">{{domain?.description}}</div>
				</div>
				<div class="row row-display">
					<div class="col-md-2"><strong>{{dataService.labelSpecification()}}</strong></div>
					<div class="col-md-10">{{specification?.fname}}</div>
					<div class="col-md-10 col-md-offset-2 row-display-inner" *ngIf="specification?.description">{{specification?.description}}</div>
				</div>
				<div class="row row-display">
					<div class="col-md-2"><strong>{{dataService.labelActor()}}</strong></div>
					<div class="col-md-10">{{actor?.name}}</div>
					<div class="col-md-10 col-md-offset-2 row-display-inner" *ngIf="actor?.description">{{actor?.description}}</div>
				</div>
				<div class="row row-display oneLineDiv" *ngIf="lastUpdate">
					<div class="col-md-2"><strong>Last update</strong></div>
					<div class="col-md-10"><span>{{lastUpdate}}</span></div>
				</div>
				<div class="row row-display oneLineDiv">
					<div class="col-md-2"><strong>Test results</strong></div>
					<div class="col-md-10">
						<div class="status-container" *ngIf="statusCounters">
							<div class="status-counts">
								<app-test-status-icons [counters]="statusCounters" [centerAligned]="false"></app-test-status-icons>
							</div>
							<div class="status-ratios">
								<app-test-result-ratio [counters]="statusCounters"></app-test-result-ratio>
							</div>
						</div>
					</div>
				</div>
				<div class="row row-display-last oneLineDiv conformanceStatusDiv">
					<div class="col-md-2"><strong>Status</strong></div>
					<div class="col-md-10"><span containerClass="shortTooltip" [tooltip]="dataService.tooltipForTestResult(conformanceStatus)"><i [ngClass]="dataService.iconForTestResult(conformanceStatus)"></i></span></div>
				</div>
			</div>
			<div class="panel-footer">
				<div class="btn-toolbar">
					<button *ngIf="canExportConformanceCertificate()" type="button" class="btn btn-default" (click)="onExportConformanceCertificate()" [pending]="exportCertificatePending" [disable]="exportCertificatePending">Download conformance certificate</button>
					<button type="button" class="btn btn-default" (click)="onExportConformanceStatement()" [pending]="exportPending">Download report</button>
					<button type="button" class="btn btn-default" *ngIf="canDelete()" (click)="deleteConformanceStatement()" [pending]="deletePending">Delete statement</button>
				</div>
			</div>
		</div>
	</div>
	<tabset #tabs>
		<tab heading="Conformance tests">
			<div class="tabPanel">
				<div class="tabControls">
					<div class="testFilters">
						<app-text-filter name="testCaseFilter" [width]="250" [placeholder]="'Search test cases...'" [(ngModel)]="testCaseFilter" (apply)="applySearchFilters()"></app-text-filter>
						<div class="resultFilterDiv">
							<app-checkbox-option-panel 
								label="Show tests..." 
								[options]="testDisplayOptions" 
								[refresh]="refreshDisplayOptions"
								(updated)="resultFilterUpdated($event)"></app-checkbox-option-panel>
						</div>
					</div>
					<div class="testSettings">
						<div class="btn-group" dropdown>
							<button id="button-executionType" dropdownToggle type="button" class="btn btn-default dropdown-toggle" aria-controls="dropdown-executionType">{{executionModeButton}}<span class="caret"></span></button>
							<ul id="dropdown-executionType" *dropdownMenu class="dropdown-menu dropdown-menu-right" role="menu" aria-labelledby="button-executionType">
							  <li role="menuitem"><a class="dropdown-item" href (click)="executionMode = executionModeInteractive; executionModeButton = executionModeLabelInteractive; $event.preventDefault()">{{executionModeLabelInteractive}}</a></li>
							  <li class="divider dropdown-divider"></li>
							  <li role="menuitem"><a class="dropdown-item" href (click)="executionMode = executionModeParallel; executionModeButton = executionModeLabelParallel; $event.preventDefault()">{{executionModeLabelParallel}}</a></li>
							  <li role="menuitem"><a class="dropdown-item" href (click)="executionMode = executionModeSequential; executionModeButton = executionModeLabelSequential; $event.preventDefault()">{{executionModeLabelSequential}}</a></li>
							</ul>
						</div>
					</div>
				</div>
				<ng-container [ngSwitch]="loadingTests">
					<app-pending-block *ngSwitchCase="true"></app-pending-block>
					<ng-container *ngSwitchDefault [ngSwitch]="displayedTestSuites.length">
						<div class="panel panel-default panel-body noTestCasesDiv" *ngSwitchCase="0" [ngSwitch]="testSuites.length">
							<span *ngSwitchCase="0">No test cases are defined in this conformance statement.</span>
							<span *ngSwitchDefault>No test cases were found matching your search criteria.</span>
						</div>
						<ng-container *ngSwitchDefault>
							<div class="panel panel-default testSuitePanel" *ngFor="let testSuite of displayedTestSuites">
								<div class="testSuiteDisplay" [class.expanded]="testSuite.expanded" (click)="onExpand(testSuite)">
									<div><app-collapsing-icon [isCollapsed]="!testSuite.expanded"></app-collapsing-icon></div>
									<div class="testSuiteName">{{testSuite.sname}}</div>
									<div *ngIf="testSuite.description != undefined && testSuite.description.trim() != ''" class="testSuiteDescription">{{testSuite.description}}</div>
									<div class="testSuiteControls">
										<div class="btn-toolbar">
											<button type="button" class="btn btn-default" *ngIf="testSuite.hasDocumentation" (click)="showTestSuiteDocumentation(testSuite.id); $event.stopPropagation();" containerClass="shortTooltip" tooltip="Documentation" [delay]="Constants.TOOLTIP_DELAY"><i class="fa-solid fa-info-circle"></i></button>
											<button class="btn btn-primary" (click)="onTestSuiteSelect(testSuite); $event.stopPropagation();" containerClass="shortTooltip" tooltip="Run all" [delay]="Constants.TOOLTIP_DELAY"><i class="fa-solid fa-play"></i></button>
										</div>
									</div>
									<div class="testSuiteResult"><i containerClass="shortTooltip" [tooltip]="dataService.tooltipForTestResult(testSuite.result)" [ngClass]="dataService.iconForTestResult(testSuite.result)"></i></div>
								</div>
								<div class="collapsibleTestCaseDiv" [collapse]="!testSuite.expanded" [isAnimated]="true">
									<div class="testCaseContainer">
										<div class="testCaseDisplay table-container">
											<table id="conformance-statement-details" class="table table-directive expandable-table">
												<thead>
													<tr>
														<th class="th-min" *ngIf="testSuite.hasOptionalTestCases || testSuite.hasDisabledTestCases"></th>
														<th class="th-nowrap">Test case</th>
														<th>Description</th>
														<th class="th-min">Last run</th>
														<th class="testcase-controls"></th>
														<th class="testcase-result"></th>
													</tr>								
												</thead>
												<tbody>
													<tr *ngFor="let testCase of testSuite.testCases">
														<td *ngIf="testSuite.hasOptionalTestCases || testSuite.hasDisabledTestCases">
															<app-prescription-level [optional]="testCase.optional" [disabled]="testCase.disabled"></app-prescription-level>
														</td>
														<td>{{testCase.sname}}</td>
														<td>{{testCase.description}}</td>
														<td class="td-min">{{testCase.updateTime}}</td>
														<td class="testcase-controls">
															<div class="btn-toolbar">
																<button *ngIf="testCase.sessionId != undefined" class="btn btn-default" (click)="toTestSession(testCase.sessionId)" containerClass="shortTooltip" tooltip="View session" [delay]="Constants.TOOLTIP_DELAY"><i class="fa-solid fa-search"></i></button>
																<button type="button" class="btn btn-default" *ngIf="testCase.hasDocumentation" (click)="showTestCaseDocumentation(testCase.id)" containerClass="shortTooltip" tooltip="Documentation" [delay]="Constants.TOOLTIP_DELAY"><i class="fa-solid fa-info-circle"></i></button>
																<button class="btn btn-primary" (click)="onTestSelect(testCase)" containerClass="shortTooltip" tooltip="Run" [disabled]="testCase.disabled" [delay]="Constants.TOOLTIP_DELAY"><i class="fa-solid fa-play"></i></button>
															</div>
														</td>
														<td class="testcase-result">
															<app-test-result-status-display [message]="testCase.outputMessage" [result]="testCase.result"></app-test-result-status-display>
														</td>
													</tr>
												</tbody>
											</table>
										</div>
									</div>
								</div>
							</div>
						</ng-container>
					</ng-container>
				</ng-container>
			</div>
		</tab>
		<tab heading="Configuration parameters" (selectTab)="loadConfigurations()">
			<div class="tabPanel" [ngSwitch]="loadingConfiguration.status != Constants.STATUS.FINISHED">
				<app-pending-block *ngSwitchCase="true"></app-pending-block>
				<ng-container *ngSwitchDefault [ngSwitch]="endpointRepresentations.length">
					<div class="panel panel-default panel-body noConfigurationDiv" *ngSwitchCase="0">
						<span>No configuration parameters are foreseen for this conformance statement.</span>
					</div>
					<div *ngSwitchDefault class="endpointPanelContainer" [ngClass]="{'list-group': hasMultipleEndpoints}">
						<div class="endpoint" class="panel panel-default endpointPanel" [ngClass]="{'list-group-item': hasMultipleEndpoints}" *ngFor="let endpoint of endpointRepresentations">
							<app-endpoint-display
								[endpoint]="endpoint"
								[hideEndpointInfo]="!hasMultipleEndpoints"
								[editable]="!dataService.isVendorUser"
								[canEdit]="canEditParameter"
								[showValues]="true"
								(edit)="onParameterSelect($event)"
								(download)="onParameterDownload($event)"
							></app-endpoint-display>
						</div>
					</div>
				</ng-container>
			</div>
		</tab>
	</tabset>
</div>
