@if (!filtering || item.filtered) {
    @if (hideSelf) {
        @if (item.items) {
            <app-conformance-statement-items-display
                #itemsComponent
                [items]="item.items"
                [wrapDescriptions]="wrapDescriptions"
                [expandable]="expandable"
                [filtering]="filtering"
                [shade]="!shade"
                [animated]="animated"
                [withCheck]="withCheck"
                [withExport]="withExport"
                [withResults]="withResults"
                [withOptions]="withOptions"
                [communityId]="communityId"
                [organisationId]="organisationId"
                [systemId]="systemId"
                [parentItem]="item"
                [domainId]="domainId"
                [snapshotId]="snapshotId"
                (selectionChanged)="childSelectionChanged($event)"
                (export)="onExport($event)"
                (selected)="childSelected($event)"
            ></app-conformance-statement-items-display>
        }
    } @else {
        <div class="item-container" [class.shade]="shade">
            <div class="item-header" (click)="clickHeader();$event.stopPropagation()" [class.actionable]="expandable || withCheck" [class.wrapDescriptions]="wrapDescriptions">
                <div class="item-header-title">
                    @if (expandable && hasChildren && !allChildrenHidden) {
                        <div class="item-icon"><app-collapsing-icon [isCollapsed]="item.collapsed!" [asDiv]="true"></app-collapsing-icon></div>
                    }
                    @if (showCheck) {
                        <div class="item-check">
                            <input type="checkbox" class="form-check-input" name="itemCheck" [(ngModel)]="item.checked" (ngModelChange)="updateChecked()">
                        </div>
                    }
                    <div class="item-name">{{item.name}}</div>
                </div>
                @if (item.description) {
                    <div class="item-description">{{item.description}}</div>
                }
                @if (withExport && expandable && hasChildren && !allChildrenHidden) {
                    <div class="item-controls">
                        <app-checkbox-option-panel #optionButton
                                                   label="Options"
                                                   icon="fa-solid fa-bars"
                                                   placement="left"
                                                   [options]="parentItemOptions"
                                                   [singleSelection]="true"
                                                   [pending]="item.exportPdfPending == true || item.exportXmlPending == true || optionPending"
                                                   (updated)="handleOption($event)"
                                                   (opening)="optionsOpening()"></app-checkbox-option-panel>
                    </div>
                }
                @if (showResults) {
                    <div class="item-results">
                        @if (pending) {
                            <div class="item-pending">
                                <app-pending-block [pending]="true"></app-pending-block>
                            </div>
                        }
                        @if (updateTime) {
                            <app-tag label="fa-solid fa-clock" [icon]="true" tooltipText="Last update time" [value]="updateTime"></app-tag>
                        }
                        @if (counters) {
                            <div class="item-counters">
                                <app-test-status-icons [counters]="counters" [asLine]="true" [refresh]="refreshCounters"></app-test-status-icons>
                            </div>
                            <div class="item-ratios">
                                <app-test-result-ratio [counters]="counters" [asLine]="true" [refresh]="refreshCounters"></app-test-result-ratio>
                            </div>
                        }
                        @if (status) {
                            <div class="item-status"><i containerClass="shortTooltip" [tooltip]="dataService.tooltipForTestResult(status)" [ngClass]="dataService.iconForTestResult(status)"></i></div>
                        }
                        @if (withOptions && conformanceIds) {
                            <div class="options-button">
                                <app-statement-options-button #statementOptionsButton
                                                              [item]="conformanceIds"
                                                              [snapshotId]="snapshotId"
                                                              [communityId]="communityId"
                                                              [organisationId]="organisationId"
                                                              [pending]="item.exportPdfPending == true || item.exportXmlPending == true || optionPending"
                                                              (export)="onExport({ statementReport: true, item: item, actorId: $event.item.actorId, format: $event.format})"
                                                              (opening)="optionsOpening()"
                                ></app-statement-options-button>
                            </div>
                        }
                    </div>
                }
            </div>
            @if (item.items && item.items.length > 0) {
                <div class="item-content-container item-content" [collapse]="item.collapsed!" [isAnimated]="expandable && animated" (expanded)="expanded()" (collapses)="collapses()">
                    <app-conformance-statement-items-display
                        #itemsComponent
                        [items]="item.items"
                        [wrapDescriptions]="wrapDescriptions"
                        [expandable]="expandable"
                        [filtering]="filtering"
                        [shade]="!shade"
                        [animated]="animated"
                        [withCheck]="withCheck"
                        [withExport]="withExport"
                        [withResults]="withResults"
                        [withOptions]="withOptions"
                        [communityId]="communityId"
                        [organisationId]="organisationId"
                        [systemId]="systemId"
                        [domainId]="domainId"
                        [snapshotId]="snapshotId"
                        [parentItem]="item"
                        (selectionChanged)="childSelectionChanged($event)"
                        (export)="onExport($event)"
                        (selected)="childSelected($event)"
                    ></app-conformance-statement-items-display>
                </div>
            }
        </div>
    }
}
