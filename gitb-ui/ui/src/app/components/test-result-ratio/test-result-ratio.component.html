<div class="root-container" (click)="$event.stopPropagation()">
    @if (hasOptional) {
        <div class="expand-icon" (click)="expanded = true" tooltip="Expand" containerClass="shortTooltip"><span><i class="fa-solid fa-plus-circle"></i></span></div>
    }
    <div class="ratio-container">
        @if (hasRequired) {
            @if (counters.completed > 0) {
                <div [tooltip]="completedPercentage+'% of all required tests are passed'" containerClass="ratioTooltip" class="ratio completed" [class.start]="true" [class.end]="counters.failed == 0 && counters.other == 0" [ngStyle]="{'width': completedPercentage+'%'}">{{completedPercentage}}%</div>
            }
            @if (counters.failed > 0) {
                <div [tooltip]="failedPercentage+'% of all required tests are failed'" containerClass="ratioTooltip" class="ratio failed" [class.start]="counters.completed == 0" [class.end]="counters.other == 0" [ngStyle]="{'width': failedPercentage+'%'}">{{failedPercentage}}%</div>
            }
            @if (counters.other > 0) {
                <div [tooltip]="otherPercentage+'% of all required tests are incomplete'" containerClass="ratioTooltip" class="ratio other" [class.start]="counters.completed == 0 && counters.failed == 0" [class.end]="true" [ngStyle]="{'width': otherPercentage+'%'}">{{otherPercentage}}%</div>
            }
        } @else {
            <div tooltip="No required tests defined" containerClass="ratioTooltip" class="ratio other" [class.start]="true" [class.end]="true" [ngStyle]="{'width': '100%'}">100%</div>
        }
    </div>
    @if (expanded) {
        <div class="popup-panel" [class.asLine]="asLine" [class.defaultPopup]="!asLine" [class.align-right]="alignRight">
            <div class="popup-panel-container">
                <div class="ratio-root-containers">
                    <div class="ratio-root-container">
                        <div class="ratio-title">Required</div>
                        <div class="ratio-container">
                            @if (hasRequired) {
                                @if (counters.completed > 0) {
                                    <div [tooltip]="completedPercentage+'% of all required tests are passed'" containerClass="ratioTooltip" class="ratio completed" [class.start]="true" [class.end]="counters.failed == 0 && counters.other == 0" [ngStyle]="{'width': completedPercentage+'%'}">{{completedPercentage}}%</div>
                                }
                                @if (counters.failed > 0) {
                                    <div [tooltip]="failedPercentage+'% of all required tests are failed'" containerClass="ratioTooltip" class="ratio failed" [class.start]="counters.completed == 0" [class.end]="counters.other == 0" [ngStyle]="{'width': failedPercentage+'%'}">{{failedPercentage}}%</div>
                                }
                                @if (counters.other > 0) {
                                    <div [tooltip]="otherPercentage+'% of all required tests are incomplete'" containerClass="ratioTooltip" class="ratio other" [class.start]="counters.completed == 0 && counters.failed == 0" [class.end]="true" [ngStyle]="{'width': otherPercentage+'%'}">{{otherPercentage}}%</div>
                                }
                            } @else {
                                <div tooltip="No required tests defined" containerClass="ratioTooltip" class="ratio other" [class.start]="true" [class.end]="true" [ngStyle]="{'width': '100%'}">100%</div>
                            }
                        </div>
                    </div>
                    @if (hasOptional) {
                        <div class="ratio-root-container optional">
                            <div class="ratio-title optional">Optional</div>
                            <div class="ratio-container">
                                @if (counters.completedOptional > 0) {
                                    <div [tooltip]="completedOptionalPercentage+'% of all optional tests are passed'" containerClass="ratioTooltip" class="ratio completed" [class.start]="true" [class.end]="counters.failedOptional == 0 && counters.otherOptional == 0" [ngStyle]="{'width': completedOptionalPercentage+'%'}">{{completedOptionalPercentage}}%</div>
                                }
                                @if (counters.failedOptional > 0) {
                                    <div [tooltip]="failedOptionalPercentage+'% of all optional tests are failed'" containerClass="ratioTooltip" class="ratio failed" [class.start]="counters.completedOptional == 0" [class.end]="counters.otherOptional == 0" [ngStyle]="{'width': failedOptionalPercentage+'%'}">{{failedOptionalPercentage}}%</div>
                                }
                                @if (counters.otherOptional > 0) {
                                    <div [tooltip]="otherOptionalPercentage+'% of all optional tests are incomplete'" containerClass="ratioTooltip" class="ratio other" [class.start]="counters.completedOptional == 0 && counters.failedOptional == 0" [class.end]="true" [ngStyle]="{'width': otherOptionalPercentage+'%'}">{{otherOptionalPercentage}}%</div>
                                }
                            </div>
                        </div>
                    }
                </div>
                <div class="close-container" (click)="expanded = false" tooltip="Close" containerClass="shortTooltip"><span><i class="fa-solid fa-times"></i></span></div>
            </div>
        </div>
    }
</div>
